<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Balap Cerdas (Versi Robot)</title>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
/* ================= TAMBAHAN SKOR & NAMA ================= */
.score-display{
    font-size:0.9em;
    font-weight:bold;
    margin-bottom:4px;
}
#playerNames input{
    display:block;
    width:90%;
    margin:6px auto;
    padding:6px;
    font-size:0.95em;
}
/* ======================================================== */

/* ===== CSS ASLI ANDA (TIDAK DIUBAH) ===== */
body{
touch-action:manipulation;
user-select:none;
font-family:Arial,sans-serif;
text-align:center;
background:#f0f0f0;
margin:0;
width:100vw;
height:100vh;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
overflow:hidden;
}
.hidden{display:none!important;}
:root{
--player1-color:#007bff;
--player2-color:#dc3545;
--player3-color:#ffc107;
--player4-color:#28a745;
--bg-color:#e6f7ff;
--track-color:#a0d8ff;
--win-line-color:#5cb85c;
--start-line-color:#f0ad4e;
}
#lobby-screen{background:white;padding:30px;border-radius:10px;max-width:600px}
#game-container{max-width:1200px;width:100%}
#race-arena{background:var(--track-color)}
.player-panel{background:white;border-radius:6px}
</style>
</head>

<body onload="loadQuestions()">

<button id="fullscreen-btn" onclick="toggleFullscreen()">
<i class="fas fa-expand"></i> Fullscreen
</button>

<div id="countdown-overlay" class="hidden"></div>

<!-- ================= LOBBY ================= -->
<div id="lobby-screen">
<h2>Balap Kuis Pengetahuan</h2>

<!-- === TAMBAHAN INPUT NAMA === -->
<div id="playerNames">
<input id="name-p1" placeholder="Nama Pemain 1">
<input id="name-p2" placeholder="Nama Pemain 2">
<input id="name-p3" placeholder="Nama Pemain 3">
<input id="name-p4" placeholder="Nama Pemain 4">
</div>

<button id="start-button" onclick="startGame()">
<i class="fas fa-play"></i> Mulai Balapan
</button>
<p id="loading-status"></p>
</div>

<!-- ================= GAME ================= -->
<div id="game-container" class="hidden">

<h1>Balap Kuis</h1>

<div id="race-arena">
<div id="finish-line">FINISH</div>

<div class="track"><div class="player-icon" id="player-icon-p1"></div></div>
<div class="track"><div class="player-icon" id="player-icon-p2"></div></div>
<div class="track"><div class="player-icon" id="player-icon-p3"></div></div>
<div class="track"><div class="player-icon" id="player-icon-p4"></div></div>

<div id="start-line">START</div>
</div>

<div class="keypad-area-bottom">

<div class="player-panel" data-player="1">
<h3 id="title-p1">Pemain 1</h3>
<div class="score-display">Skor: <span id="score-p1">0</span></div>
<div class="question-display" id="q-p1"></div>
<div class="keypad" data-keypad="1">
<button data-key="A"></button>
<button data-key="B"></button>
<button data-key="C"></button>
</div>
</div>

<div class="player-panel" data-player="2">
<h3 id="title-p2">Pemain 2</h3>
<div class="score-display">Skor: <span id="score-p2">0</span></div>
<div class="question-display" id="q-p2"></div>
<div class="keypad" data-keypad="2">
<button data-key="A"></button>
<button data-key="B"></button>
<button data-key="C"></button>
</div>
</div>

<div class="player-panel" data-player="3">
<h3 id="title-p3">Pemain 3</h3>
<div class="score-display">Skor: <span id="score-p3">0</span></div>
<div class="question-display" id="q-p3"></div>
<div class="keypad" data-keypad="3">
<button data-key="A"></button>
<button data-key="B"></button>
<button data-key="C"></button>
</div>
</div>

<div class="player-panel" data-player="4">
<h3 id="title-p4">Pemain 4</h3>
<div class="score-display">Skor: <span id="score-p4">0</span></div>
<div class="question-display" id="q-p4"></div>
<div class="keypad" data-keypad="4">
<button data-key="A"></button>
<button data-key="B"></button>
<button data-key="C"></button>
</div>
</div>

</div>

<h2 id="message-display"></h2>
<div id="scoreSummary"></div>
<button id="restart-btn" class="hidden">Kembali ke Lobi</button>

</div>

<script>
/* ================= DATA PLAYER ================= */
const playerKeys=[1,2,3,4];
const players=playerKeys.map(p=>({
id:p,
name:`Pemain ${p}`,      // === TAMBAHAN ===
score:0,                // === TAMBAHAN ===
position:0,
element:document.getElementById(`player-icon-p${p}`),
questionDisplay:document.getElementById(`q-p${p}`),
keypad:document.querySelector(`[data-keypad="${p}"]`),
correctAnswer:'',
isLocked:false
}));

const finishSteps=10;
let gameActive=false;

/* ================= START GAME ================= */
function startGame(){
players.forEach(p=>{
const input=document.getElementById(`name-p${p.id}`);
p.name=input.value.trim()||`Pemain ${p.id}`;
document.getElementById(`title-p${p.id}`).textContent=p.name;
p.score=0;
document.getElementById(`score-p${p.id}`).textContent=0;
});
document.getElementById("lobby-screen").classList.add("hidden");
document.getElementById("game-container").classList.remove("hidden");
startRace();
}

/* ================= GAME LOGIC ================= */
function startRace(){
gameActive=true;
players.forEach(p=>{
generateQuestion(p);
activateKeypad(p.keypad);
});
}

function generateQuestion(player){
player.correctAnswer="BENAR";
player.questionDisplay.textContent="Contoh Soal?";
const btns=player.keypad.querySelectorAll("button");
btns.forEach((b,i)=>{
b.textContent=["A. BENAR","B. SALAH","C. SALAH"][i];
b.dataset.value=b.textContent.includes("BENAR")?"BENAR":"SALAH";
});
}

async function checkAnswer(player,answer){
if(!gameActive||player.isLocked)return;
if(answer===player.correctAnswer){
player.score+=10;
document.getElementById(`score-p${player.id}`).textContent=player.score;
player.position++;
player.element.style.left=(player.position/finishSteps*80)+"%";
if(player.position>=finishSteps){
endGame(player);
return;
}
generateQuestion(player);
}else{
player.isLocked=true;
deactivateKeypad(player.keypad);
await new Promise(r=>setTimeout(r,2000));
player.isLocked=false;
activateKeypad(player.keypad);
generateQuestion(player);
}
}

function endGame(winner){
gameActive=false;
document.getElementById("message-display").textContent=
`ðŸ† ${winner.name} MENANG! (Skor ${winner.score})`;

const ranking=[...players].sort((a,b)=>b.score-a.score);
let html="<h3>Rekap Skor</h3><ol>";
ranking.forEach(p=>{
html+=`<li>${p.name} â€” ${p.score}</li>`;
});
html+="</ol>";
document.getElementById("scoreSummary").innerHTML=html;
runConfetti();
}

/* ================= UTIL ================= */
function activateKeypad(k){k.querySelectorAll("button").forEach(b=>b.disabled=false)}
function deactivateKeypad(k){k.querySelectorAll("button").forEach(b=>b.disabled=true)}

document.querySelectorAll(".keypad").forEach(k=>{
k.addEventListener("click",e=>{
if(e.target.tagName==="BUTTON"){
const p=players.find(x=>x.id==k.dataset.keypad);
checkAnswer(p,e.target.dataset.value);
}
});
});

function runConfetti(){
confetti({particleCount:150,spread:120,origin:{y:0.6}});
}
</script>

</body>
</html>
